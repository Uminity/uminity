<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css"
          rel="stylesheet" integrity="sha384-SgOJa3DmI69IUzQ2PVdRZhwQ+dy64/BUtbMJw1MZ8t5HZApcHrRKUc4W0kG879m7"
          crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-k6d4wzSIapyDyv1kpU366/PK5hCdSbCRGRCMv+eplOQJWyd1fbcAu9OCUj5zNLiq"
            crossorigin="anonymous"></script>
    <link rel="stylesheet" href="/assets/css/style.css">
    <link rel="icon" type="image/png" href="/assets/images/favicon.png">
    <title>Uminity</title>
</head>

<body>

    <!-- â‘  navbar -->
    <div id="nav-placeholder" class="pb-5"></div>

    <!-- â‘¡ Hot Issues -->
    <div class="container mb-4">
        <h4 class="text-danger fw-bold mb-3">ğŸ”¥ Hot Issues</h4>
        <ul class="list-group" id="hotList">
            <!-- JSê°€ ìƒìœ„ 3ê°œ ê¸€ì„ ì—¬ê¸°ë‹¤ ì‚½ì…í•©ë‹ˆë‹¤ -->
        </ul>
    </div>

    <!-- â‘¢ ê²Œì‹œíŒ -->
    <div class="container">
        <div class="row mb-3">
            <div class="col">
                <div class="dropdown">
                    <button class="btn btn-primary dropdown-toggle" type="button"
                            data-bs-toggle="dropdown" aria-expanded="false">ì˜µì…˜
                    </button>
                    <ul class="dropdown-menu" id="pageOptionMenu">
                        <li><a class="dropdown-item" href="#" data-value="3">3ê°œì”© ë³´ê¸°</a></li>
                        <li><a class="dropdown-item" href="#" data-value="5">5ê°œì”© ë³´ê¸°</a></li>
                        <li><a class="dropdown-item" href="#" data-value="10">10ê°œì”© ë³´ê¸°</a></li>
                    </ul>
                </div>
            </div>
            <div class="input-group col mb-3">
                <button class="btn btn-outline-secondary dropdown-toggle" id="searchTypeButton"
                        type="button" data-bs-toggle="dropdown" aria-expanded="false">ì œëª©
                </button>
                <ul class="dropdown-menu" id="searchType">
                    <li><a class="dropdown-item" href="#" data-value="TITLE">ì œëª©</a></li>
                    <li><a class="dropdown-item" href="#" data-value="CONTENT">ë‚´ìš©</a></li>
                    <li><a class="dropdown-item" href="#" data-value="ALL">ì œëª©+ë‚´ìš©</a></li>
                </ul>
                <input type="hidden" id="selectedSearchType" value="TITLE">
                <input type="text" class="form-control" id="keyword" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                <button class="btn btn-primary" type="button" id="btnSearch">ê²€ìƒ‰</button>
            </div>
        </div>

        <div class="card shadow-sm rounded-4 mb-4 overflow-hidden">
            <table class="table table-hover mb-0">
                <thead class="table-light">
                <tr>
                    <th class="text-center">ë²ˆí˜¸</th>
                    <th>ì œëª©</th>
                    <th class="text-center">ì‘ì„±ì</th>
                    <th class="text-center">ì‘ì„±ì¼</th>
                    <th class="text-center">ì¡°íšŒìˆ˜</th>
                </tr>
                </thead>
                <tbody id="postList"></tbody>
            </table>
        </div>

        <div class="d-flex justify-content-end mb-4">
            <a href="/postForm" class="btn btn-primary fw-bold rounded-3">ê¸€ ì‘ì„±</a>
        </div>

        <div id="paginationWrapper"></div>
    </div>

    <!-- footer -->
    <footer class="bg-light text-center text-lg-start mt-5 border-top">
        <div class="container p-4">
            <p class="text-center mb-0 text-muted">Â© 2025 Uminity. All rights reserved.</p>
        </div>
    </footer>

    <script src="/assets/js/util.js"></script>
    <script>
        window.onload = function () {
            // 1) ê³µí†µ ë„¤ë¹„ ë¡œë“œ
            loadNavbar();

            // 2) Hot Issues ë°ì´í„° ë¡œë“œ (ì¡°íšŒìˆ˜ ë‚´ë¦¼ì°¨ìˆœ ìƒìœ„ 3ê°œ)
            fetch('/api/posts?page=0&size=3&sort=viewCnt,desc')
                .then(res => res.json())
                .then(data => {
                    const hotList = document.getElementById('hotList');
                    hotList.innerHTML = '';
                    data.content.forEach(post => {
                        const li = document.createElement('li');
                        li.className = 'list-group-item d-flex justify-content-between align-items-center';
                        li.innerHTML = `
              <a href="/postDetail/${post.postId}" class="text-decoration-none flex-grow-1">
                ${post.title}
              </a>
              <span class="badge bg-danger rounded-pill">${post.viewCnt}</span>
            `;
                        hotList.appendChild(li);
                    });
                })
                .catch(err => console.error('Hot Issues ë¡œë“œ ì‹¤íŒ¨:', err));

            // 3) ê¸°ì¡´ ê²€ìƒ‰Â·í˜ì´ì§€ ì˜µì…˜ ë°”ì¸ë”©
            document.getElementById("btnSearch").onclick = function () {
                SEARCH_TYPE = document.querySelector("#selectedSearchType").value;
                SEARCH_WORD = document.querySelector("#keyword").value;
                postList();
            };
            document.querySelectorAll("#searchType .dropdown-item").forEach(item => {
                item.addEventListener("click", function (e) {
                    e.preventDefault();
                    document.getElementById("searchTypeButton").textContent = this.textContent;
                    document.getElementById("selectedSearchType").value = this.getAttribute("data-value");
                });
            });
            document.querySelectorAll("#pageOptionMenu .dropdown-item").forEach(item => {
                item.addEventListener("click", function (e) {
                    e.preventDefault();
                    SIZE = +this.getAttribute("data-value");
                    PAGE = 0;
                    CURRENT_PAGE_INDEX = 1;
                    postList();
                });
            });

            // 4) ì´ˆê¸° ì „ì²´ ëª©ë¡ í˜¸ì¶œ
            postList();
        };

        let SIZE = 10, PAGE = 0, SEARCH_TYPE = 'TITLE', SEARCH_WORD = '';
        let TOTAL_POST_COUNT = 0, PAGE_LINK_COUNT = 10, CURRENT_PAGE_INDEX = 1;

        // ê²Œì‹œê¸€ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
        async function postList() {

            let url = "/api/posts";
            let urlParams = "?page=" + PAGE +
                "&size=" + SIZE +
                "&searchType=" + SEARCH_TYPE +
                "&keyword=" + encodeURIComponent(SEARCH_WORD);

            let response = await fetch(url + urlParams); // api í˜¸ì¶œ


            if (response.ok) {
                let data = await response.json(); // json ë³€í™˜
                console.log(data);
                let posts = data.content; // post ëª©ë¡

                TOTAL_POST_COUNT = posts.totalElements; // ì „ì²´ ê²Œì‹œê¸€ ìˆ˜
                PAGE_LINK_COUNT = data.totalPages;

                makeListHtml(posts); // ê²Œì‹œê¸€ ë¶€ë¶„
                addPagination(); // í˜ì´ì§€ë„¤ì´ì…˜ ë¶€ë¶„

            } else {
                console.error("HTTP Error:", response.status);
            }
        }


        function makeListHtml(posts) {
            let postListDiv = document.querySelector("#postList");
            postListDiv.innerHTML = "";

            posts.forEach(post => {
                let postDate = formatDate(post.createdAt);
                let tableHtml = `
					<tr>
						<td class="text-center">${post.postId}</td>
						<td><a href="/postDetail/${post.postId}" class="text-decoration-none text-primary fw-semibold">${post.title}</a></td>
						<td class="text-center">${post.authorName}</td>
						<td class="text-center">${postDate}</td>
						<td class="text-center">${post.viewCnt}</td>
					</tr>
				`;
                postListDiv.innerHTML += tableHtml;
            });
            window.postData = posts;
        }


        function addPagination() {
            makePaginationHTML(SIZE, PAGE_LINK_COUNT, CURRENT_PAGE_INDEX, TOTAL_POST_COUNT, "paginationWrapper");
        }

    </script>
</body>
</html>
