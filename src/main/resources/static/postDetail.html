<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-SgOJa3DmI69IUzQ2PVdRZhwQ+dy64/BUtbMJw1MZ8t5HZApcHrRKUc4W0kG879m7" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-k6d4wzSIapyDyv1kpU366/PK5hCdSbCRGRCMv+eplOQJWyd1fbcAu9OCUj5zNLiq"
            crossorigin="anonymous"></script>
    <link rel="stylesheet" href="/assets/css/style.css">
    <link rel="icon" type="image/png" href="/assets/images/favicon.png">
    <title>Uminity</title>
    <!-- head íƒœê·¸ ë‚´ì— ë¶€íŠ¸ìŠ¤íŠ¸ë© ì•„ì´ì½˜ ì¶”ê°€ -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
</head>

<body>

<!-- navbar -->
<div id="nav-placeholder" class="pb-5"></div>

<!-- ê²Œì‹œê¸€ ìƒì„¸ -->
<div class="container mt-5">
    <div class="card mb-4 shadow-sm" id="postDetail">
        <!-- ë‚´ìš©ì€ JavaScriptë¡œ ì±„ì›Œì§‘ë‹ˆë‹¤ -->
    </div>

    <!-- ëŒ“ê¸€ -->
    <div class="mb-4">
        <h5 class="d-flex align-items-center mb-3">
            <i class="bi bi-chat-dots me-2"></i> ëŒ“ê¸€ <span id="commentCount"
                                                          class="ms-2 badge bg-primary rounded-pill"></span>
        </h5>
        <div class="card shadow-sm mb-3">
            <!-- ëŒ“ê¸€ ì…ë ¥ -->
            <div class="card-body">
                <textarea class="form-control p-3 mb-3" id="commentInput" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”." rows="3"
                          style="resize: none;"></textarea>
                <div class="d-flex justify-content-end">
                    <button class="btn btn-primary" id="commentSubmit">
                        <i class="bi bi-send"></i> ë“±ë¡
                    </button>
                </div>
            </div>
        </div>
        <!-- ëŒ“ê¸€ ëª©ë¡ -->
        <div class="mb-3" id="commentDiv"></div>
    </div>
</div>

<!-- ì¢‹ì•„ìš” ëˆ„ë¥¸ ì‚¬ëŒ ëª©ë¡ ëª¨ë‹¬ -->
<div class="modal fade" id="likeListModal" tabindex="-1" aria-labelledby="likeListModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="likeListModalLabel">ì¢‹ì•„ìš” ëˆ„ë¥¸ ì‚¬ëŒ ëª©ë¡</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="likeListContainer">
                <!-- ì¢‹ì•„ìš” ëª©ë¡ì´ ì—¬ê¸°ì— ë Œë”ë§ ë©ë‹ˆë‹¤ -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ë‹«ê¸°</button>
            </div>
        </div>
    </div>
</div>


<!-- footer -->
<footer class="bg-light text-center text-lg-start mt-5 border-top">
    <div class="container p-4">
        <p class="text-center mb-0 text-muted">
            Â© 2025 Uminity. All rights reserved.
        </p>
    </div>
</footer>

<script src="/assets/js/util.js"></script>
<script src="/assets/js/alert.js"></script>
<script>
    const postId = window.location.pathname.split('/').pop();
    let PAGE = 0, SIZE = 100;

    window.onload = function () {
        initUtil();       // CSRF í† í° ì´ˆê¸°í™”
        loadNavbar();     // ë„¤ë¹„ ë¡œë“œ
        postDetail();     // ê²Œì‹œê¸€ ë°ì´í„° ë¡œë“œ
        listComments();   // ëŒ“ê¸€ ë¦¬ìŠ¤íŠ¸ ë¡œë“œ
        document.getElementById('commentSubmit')
            .addEventListener('click', createComment);
    };

    async function postDetail() {
        try {
            const res = await fetch(`/api/posts/${postId}`,
                {
                    method: 'GET',
                    credentials: 'include' // â† ì´ê²Œ í•„ìˆ˜!
                }
            );
            if (!res.ok) throw res;
            const post = await res.json();

            const postDate = formatDate(post.createdAt);
            document.getElementById('postDetail').innerHTML = `
                    <div class="card-body">
                        <h2 class="card-title">${post.title}</h2>
                        <p class="text-muted mb-2">
                            <i class="bi bi-person-circle me-1"></i> <strong>${post.authorName}</strong> |
                            <i class="bi bi-calendar3 ms-2 me-1"></i> <strong>${postDate}</strong>
                            <i class="bi bi-eye-fill ms-2 me-1"></i> <strong>${post.viewCnt}</strong>
                        </p>
                        <div class="card-text mb-4 p-3 bg-light rounded">${post.content}</div>
                        <div class="d-flex justify-content-end">
                            <a href="/postForm/${post.postId}" class="btn btn-outline-primary me-2">
                                <i class="bi bi-pencil"></i> ìˆ˜ì •
                            </a>
                            <button class="btn btn-outline-danger" id="btnDelete">
                                <i class="bi bi-trash"></i> ì‚­ì œ
                            </button>
                        </div>
                        <hr>
                        
                        <button class="btn btn-outline-secondary" id="likeBtn" onclick="toggleLike()">
                        	<i class="bi bi-heart" id="likeIcon"></i> ì¢‹ì•„ìš”
                        	<span id="likeCount-${postId}">(0ëª…)</span>
                        </button>
                       	<button class="btn btn-outline-secondary" id="likeListBtn"onclick="viewLikeListModal()">
                       		<i class="bi bi-people" id="likeListIcon"></i>
                        </button>
                    </div>
                `;

            document.getElementById('btnDelete')
                .addEventListener('click', deletePost);
            likeList();
            checkLikePost();
        } catch (err) {
            console.error('ê²Œì‹œê¸€ ë¡œë“œ ì˜¤ë¥˜:', err);
        }
    }

    async function deletePost() {
        const confirmed = await showConfirm('ì´ ê²Œì‹œê¸€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?', 'ê²Œì‹œê¸€ ì‚­ì œ', 'ì‚­ì œí•˜ê¸°', 'ì·¨ì†Œ');
        if (!confirmed) return;

        try {
            const res = await util.fetchWithCsrf(`/api/posts/${postId}`, {method: 'DELETE'});
            if (res.ok) {
                showSuccessAlert('ê²Œì‹œê¸€ì´ ì„±ê³µì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                setTimeout(() => window.location.href = '/', 850);
            } else {
                showWarningAlert('ë³¸ì¸ ê²Œì‹œê¸€ë§Œ ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤..');
            }
        } catch (err) {
            console.error('ì‚­ì œ ì˜¤ë¥˜:', err);
            showErrorAlert('ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }
    }

    // ëŒ“ê¸€
    // ëŒ“ê¸€ ë¶ˆëŸ¬ì˜¤ê¸°
    async function listComments() {
        let url = `/api/posts/${postId}/comments?page=${PAGE}&size=${SIZE}`;
        let response = await fetch(url);
        if (response.ok) {
            let data = await response.json();
            PAGE = data.page, SIZE = data.size;
            total_elements = data.totalElements, total_pages = data.totalPages;
            let comments = data.content;

            // ëŒ“ê¸€ ê°œìˆ˜ (ëŒ€ëŒ“ê¸€ í¬í•¨)
            let totalWithReplies = comments.reduce((total, comment) => {
                return total + 1 + (comment.children ? comment.children.length : 0);
            }, 0);
            document.querySelector("#commentCount").innerText = `(${totalWithReplies})`;

            let commentDiv = document.querySelector("#commentDiv");
            commentDiv.innerHTML = "";  // ì´ˆê¸°í™”

            // ëŒ“ê¸€ ë Œë”ë§
            comments.forEach(comment => {
                // ëŒ“ê¸€ ë³¸ë¬¸ ì¶”ê°€ (ìµœì‹ ìˆœ)
                let commentHtml = generateCommentHtml(comment);
                commentDiv.insertAdjacentHTML("afterbegin", commentHtml);

                // ëŒ€ëŒ“ê¸€ì´ ìˆëŠ” ê²½ìš° ìµœì‹ ìˆœìœ¼ë¡œ ì¶”ê°€
                if (comment.children && comment.children.length > 0) {
                    // ëŒ€ëŒ“ê¸€ë„ ìµœì‹ ìˆœìœ¼ë¡œ
                    comment.children.reverse().forEach(reply => {
                        let replyHtml = generateReplyHtml(reply);
                        document.querySelector(`#comment-${comment.commentId}`).insertAdjacentHTML("afterend", replyHtml);
                    });
                }
            });
        } else {
            console.error("HTTP Error:", response.status);
        }
    }

    // 1. ëŒ“ê¸€ HTML ìƒì„± í•¨ìˆ˜
    function generateCommentHtml(comment) {
        return `
		        <div class="comment-item mb-3 rounded border p-3" id="comment-${comment.commentId}">
		            <div class="d-flex justify-content-between align-items-center mb-2">
		                <div>
		                    <strong><i class="bi bi-person-circle me-1"></i> ${comment.userName}</strong>
		                    <small class="text-muted ms-2"><i class="bi bi-clock me-1"></i>${formatDate(comment.createdAt)}</small>
		                </div>
		            </div>
		            <div class="comment-content mb-2" id="content-${comment.commentId}">
		                <p class="mb-0">${comment.content}</p>
		            </div>
		            <div class="row">
		                <div class="col d-flex align-items-center">
		                    <a href="#" onclick="toggleReplyForm(${comment.commentId}); return false;">ë‹µê¸€ì“°ê¸°</a>
		                </div>
		                <div class="col d-flex justify-content-end">
		                    <button class="btn btn-outline-primary btn-sm me-2" onclick="enableEdit(${comment.commentId})" id="editBtn-${comment.commentId}">
		                        <i class="bi bi-pencil"></i> ìˆ˜ì •
		                    </button>
		                    <button class="btn btn-outline-danger btn-sm" onclick="deleteComment(${comment.commentId})" id="deleteBtn-${comment.commentId}">
		                        <i class="bi bi-trash"></i> ì‚­ì œ
		                    </button>
		                </div>
		            </div>
		            <div class="reply-form mt-2" id="replyForm-${comment.commentId}" style="display: none;">
		                <textarea class="form-control mb-2" id="replyCommentInput-${comment.commentId}" placeholder="ë‹µê¸€ì„ ì…ë ¥í•˜ì„¸ìš”."></textarea>
		                <div class="d-flex justify-content-end">
		                    <button class="btn btn-success btn-sm me-2" onclick="createReplyComment(${comment.commentId})">ë“±ë¡</button>
		                    <button class="btn btn-secondary btn-sm" onclick="toggleReplyForm(${comment.commentId})">ì·¨ì†Œ</button>
		                </div>
		            </div>
		        </div>
		    `;
    }

    // 2. ëŒ“ê¸€ ì‘ì„±
    async function createComment() {
        const content = document.getElementById('commentInput').value.trim();
        const userJson = sessionStorage.getItem('user');
        if (!content) return showWarningAlert('ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”.');

        const userId = userJson ? JSON.parse(userJson).userId : null;
        if (userId == null) {
            showWarningAlert('ë¡œê·¸ì¸ í›„ ì´ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.');
            return;
        }

        try {
            const res = await util.fetchWithCsrf(`/api/posts/${postId}/comments`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({postId, userId, content})
            });
            if (res.ok) {
                document.getElementById('commentInput').value = '';
                listComments();
            } else {
                showErrorAlert('ëŒ“ê¸€ ì‘ì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        } catch (err) {
            console.error('ëŒ“ê¸€ ì‘ì„± ì˜¤ë¥˜:', err);
            showErrorAlert('ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }
    }


    // 3. ëŒ“ê¸€ ìˆ˜ì • í™œì„±í™”
    async function enableEdit(commentId) {
        let contentDiv = document.getElementById(`content-${commentId}`);
        let originalContent = contentDiv.textContent.trim();

        // ì›ë˜ ë²„íŠ¼ ìˆ¨ê¸°ê¸°
        document.querySelector(`#editBtn-${commentId}`).style.display = "none";
        document.querySelector(`#deleteBtn-${commentId}`).style.display = "none";

        contentDiv.innerHTML = `
	            <textarea class="form-control mb-2">${originalContent}</textarea>
	            <div class="d-flex justify-content-end">
	                <button class="btn btn-success btn-sm me-2" onclick="saveComment(${commentId})">ì €ì¥</button>
	                <button class="btn btn-secondary btn-sm" onclick="cancelEdit(${commentId}, '${originalContent}')">ì·¨ì†Œ</button>
	            </div>
	        `;
    }

    // 4. ëŒ“ê¸€ ìˆ˜ì • ì§„í–‰
    async function saveComment(commentId) {
        const contentDiv = document.getElementById(`content-${commentId}`);
        const updated = contentDiv.querySelector('textarea').value.trim();
        if (!updated) return showWarningAlert('ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”.');
        try {
            const res = await util.fetchWithCsrf(`/api/posts/${postId}/comments/${commentId}`, {
                method: 'PUT',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({content: updated})
            });
            if (res.ok) {
                contentDiv.innerHTML = `<p class="mb-0">${updated}</p>`;
                document.getElementById(`editBtn-${commentId}`).style.display = 'inline-block';
                document.getElementById(`deleteBtn-${commentId}`).style.display = 'inline-block';
            } else {
                showErrorAlert('ëŒ“ê¸€ ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        } catch (err) {
            console.error('ëŒ“ê¸€ ìˆ˜ì • ì˜¤ë¥˜:', err);
            showErrorAlert('ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }
    }

    // 5. ëŒ“ê¸€ ìˆ˜ì • ì·¨ì†Œ
    function cancelEdit(commentId, originalContent) {
        const contentDiv = document.getElementById(`content-${commentId}`);
        // ì›ë˜ ë‚´ìš© ë³´ì—¬ì£¼ê¸°
        contentDiv.innerHTML = `<p>${originalContent}</p>`;
        // ì›ë˜ ë²„íŠ¼ ë³´ì—¬ì£¼ê¸°
        document.querySelector(`#editBtn-${commentId}`).style.display = "block";
        document.querySelector(`#deleteBtn-${commentId}`).style.display = "block";
    }

    // 6. ëŒ“ê¸€ ì‚­ì œ
    async function deleteComment(commentId) {
        const confirmed = await showConfirm('ì´ ëŒ“ê¸€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?', 'ëŒ“ê¸€ ì‚­ì œ', 'ì‚­ì œí•˜ê¸°', 'ì·¨ì†Œ');
        if (!confirmed) return;
        try {
            const res = await util.fetchWithCsrf(`/api/posts/${postId}/comments/${commentId}`, {method: 'DELETE'});
            if (res.ok) {
                showSuccessAlert('ëŒ“ê¸€ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                listComments();
            } else {
                showWarningAlert('ë³¸ì¸ ëŒ“ê¸€ë§Œ ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤..');
            }
        } catch (err) {
            console.error('ëŒ“ê¸€ ì‚­ì œ ì˜¤ë¥˜:', err);
            showErrorAlert('ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }
    }

    // ëŒ€ëŒ“ê¸€
    // 1. ëŒ€ëŒ“ê¸€ HTML ìƒì„± í•¨ìˆ˜
    function generateReplyHtml(reply) {
        return `
		        <div class="reply-item mb-3 rounded border p-3 ms-4" id="reply-${reply.commentId}">
		            <div class="d-flex justify-content-between align-items-center mb-2">
		                <div>
		                    <strong><i class="bi bi-person-circle me-1"></i> ${reply.userName}</strong>
		                    <small class="text-muted ms-2"><i class="bi bi-clock me-1"></i>${formatDate(reply.createdAt)}</small>
		                </div>
		            </div>
		            <div class="comment-content mb-2" id="content-${reply.commentId}">
		            	<p class="mb-0"><i class="bi bi-arrow-return-right"> </i>${reply.content}</p>
		            </div>
		            <div class="row">
		                <div class="col d-flex justify-content-end">
		                    <button class="btn btn-outline-primary btn-sm me-2" onclick="enableEdit(${reply.commentId})" id="editBtn-${reply.commentId}">
		                        <i class="bi bi-pencil"></i> ìˆ˜ì •
		                    </button>
		                    <button class="btn btn-outline-danger btn-sm" onclick="deleteComment(${reply.commentId})" id="deleteBtn-${reply.commentId}">
		                        <i class="bi bi-trash"></i> ì‚­ì œ
		                    </button>
		                </div>
		            </div>
		        </div>
		    `;
    }

    // 2. ëŒ€ëŒ“ê¸€ ì‘ì„± í™œì„±í™” (í† ê¸€)
    function toggleReplyForm(commentId) {
        let replyForm = document.getElementById(`replyForm-${commentId}`);
        if (replyForm.style.display === 'none') {
            replyForm.style.display = 'block';
        } else {
            replyForm.style.display = 'none';
        }
    }


    // 3. ëŒ€ëŒ“ê¸€ ì‘ì„±
    async function createReplyComment(parentId) {
        const content = document.getElementById(`replyCommentInput-${parentId}`).value.trim();
        const userJson = sessionStorage.getItem('user');
        if (!content) return showWarningAlert('ëŒ€ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”.');

        const userId = userJson ? JSON.parse(userJson).userId : null;
        try {
            const res = await util.fetchWithCsrf(`/api/posts/${postId}/comments`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({postId, userId, content, parentId})
            });
            if (res.ok) {
                document.getElementById('commentInput').value = '';
                listComments();
            } else {
                showErrorAlert('ëŒ“ê¸€ ì‘ì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        } catch (err) {
            console.error('ëŒ“ê¸€ ì‘ì„± ì˜¤ë¥˜:', err);
            showErrorAlert('ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }
    }


        // 3. ëŒ€ëŒ“ê¸€ ì‘ì„±
        async function createReplyComment(parentId) {
            const content = document.getElementById(`replyCommentInput-${parentId}`).value.trim();
            const userJson = sessionStorage.getItem('user');
            if (!content) return showWarningAlert('ëŒ€ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”.');

            const userId = userJson ? JSON.parse(userJson).userId : null;
            try {
                const res = await util.fetchWithCsrf(`/api/posts/${postId}/comments`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({postId, userId, content, parentId})
                });
                if (res.ok) {
                    document.getElementById('commentInput').value = '';
                    listComments();
                } else {
                    showErrorAlert('ëŒ“ê¸€ ì‘ì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (err) {
                console.error('ëŒ“ê¸€ ì‘ì„± ì˜¤ë¥˜:', err);
                showErrorAlert('ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ì¢‹ì•„ìš”
        // ì¢‹ì•„ìš” í† ê¸€
        async function toggleLike() {
            try {
                let url = `/api/posts/${postId}/like`;
                let res = await util.fetchWithCsrf(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });

                if (res.ok) {
                    let data = await res.json();
                    console.log(data);

                    let likeBtn = document.querySelector("#likeBtn");
            		let likeIcon = document.querySelector("#likeIcon");
            		let likeListBtn = document.querySelector("#likeListBtn");
            		let likeListIcon = document.querySelector("#likeListIcon");
            		
            		if (data.likedByMe) {
                        likeBtn.classList.remove("btn-outline-secondary");
                        likeBtn.classList.add("btn-danger");
                        likeIcon.classList.remove("bi-heart");
                        likeIcon.classList.add("bi-heart-fill");
                        likeListBtn.classList.remove("btn-outline-secondary");
                        likeListBtn.classList.add("btn-danger");
                        likeListIcon.classList.remove("bi-people");
                        likeListIcon.classList.add("bi-people-fill");
                    } else {
                        likeBtn.classList.remove("btn-danger");
                        likeBtn.classList.add("btn-outline-secondary");
                        likeIcon.classList.remove("bi-heart-fill");
                        likeIcon.classList.add("bi-heart");
                        likeListBtn.classList.remove("btn-danger");
                        likeListBtn.classList.add("btn-outline-secondary");
                        likeListIcon.classList.remove("bi-people-fill");
                        likeListIcon.classList.add("bi-people");
                    }
            		likeList();
                } else {
                    console.error("HTTP Error:", res.status);
                }
            } catch (error) {
                console.error("Error:", error);
            }
        }
        
        // ì¢‹ì•„ìš” ëˆ„ë¥¸ ì‚¬ëŒ ëª©ë¡
        async function likeList() {
            try {
                let url = `/api/posts/${postId}/likers`;
                let res = await fetch(url, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });

                if (res.ok) {
                    // ì„œë²„ì—ì„œ ì‘ë‹µë°›ì€ JSON íŒŒì‹±
                    let data = await res.json();
                    console.log(data);
                    
                 	// ğŸ‘ ì¢‹ì•„ìš” ìˆ˜ ì—…ë°ì´íŠ¸
                    const likeCountElement = document.getElementById(`likeCount-${postId}`);
                    likeCountElement.textContent = `(${data.totalElements}ëª…)`;
                    
                    const likeListContainer = document.getElementById("likeListContainer");
                    likeListContainer.innerHTML = "";  // ê¸°ì¡´ ëª©ë¡ ì´ˆê¸°í™”
                    
                    if (data.content.length > 0) {
                        // ì¢‹ì•„ìš” ëª©ë¡ ë Œë”ë§
                        data.content.forEach(username => {
                            likeListContainer.insertAdjacentHTML("beforeend", `
                                <div class="list-group-item d-flex align-items-center">
                                    <i class="bi bi-person-circle me-2"></i>
                                    <span>${username}</span>
                                </div>
                            `);
                        });
                    } else {
                        likeListContainer.innerHTML = "<p class='text-muted'>ì•„ì§ ì¢‹ì•„ìš”ë¥¼ ëˆ„ë¥¸ ì‚¬ëŒì´ ì—†ìŠµë‹ˆë‹¤.</p>";
                    }
                    
                } else {
                    console.error("HTTP Error:", res.status);
                }
            } catch (error) {
                console.error("Error:", error);
            }
        }
        
        function viewLikeListModal() {
        	const likeListModal = new bootstrap.Modal(document.getElementById("likeListModal"));
            likeListModal.show();
        }
        
        async function checkLikePost() {
            try {
                let url = `/api/posts/${postId}/like`;
                let res = await fetch(url, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                let likeBtn = document.querySelector("#likeBtn");
        		let likeIcon = document.querySelector("#likeIcon");
        		let likeListBtn = document.querySelector("#likeListBtn");
        		let likeListIcon = document.querySelector("#likeListIcon");
        		
                if (res.ok) {
                    // ì„œë²„ì—ì„œ ì‘ë‹µë°›ì€ JSON íŒŒì‹±
                    let data = await res.json();
                    console.log(data);
                    
                    if(data.check){
                    	likeBtn.classList.remove("btn-outline-secondary");
                        likeBtn.classList.add("btn-danger");
                        likeIcon.classList.remove("bi-heart");
                        likeIcon.classList.add("bi-heart-fill");
                        likeListBtn.classList.remove("btn-outline-secondary");
                        likeListBtn.classList.add("btn-danger");
                        likeListIcon.classList.remove("bi-people");
                        likeListIcon.classList.add("bi-people-fill");	
                    }
				
                    
                } else {
                    console.error("HTTP Error:", res.status);
                }
            } catch (error) {
                console.error("Error:", error);
            }
        }
    </script>
</body>
</html>
