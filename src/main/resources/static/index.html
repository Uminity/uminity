<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css"
          rel="stylesheet" integrity="sha384-SgOJa3DmI69IUzQ2PVdRZhwQ+dy64/BUtbMJw1MZ8t5HZApcHrRKUc4W0kG879m7"
          crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-k6d4wzSIapyDyv1kpU366/PK5hCdSbCRGRCMv+eplOQJWyd1fbcAu9OCUj5zNLiq"
            crossorigin="anonymous"></script>
    <link rel="stylesheet" href="/assets/css/style.css">
    <link rel="icon" type="image/png" href="/assets/images/favicon.png">
    <title>Uminity</title>
</head>

<body>

    <!-- ‚ë† navbar -->
    <div id="nav-placeholder" class="pb-5"></div>

    <!-- ‚ë° Hot Issues -->
    <div class="container mb-4">
        <h4 class="text-danger fw-bold mb-3">üî• Hot Issues</h4>
        <ul class="list-group" id="hotList">
            <!-- JSÍ∞Ä ÏÉÅÏúÑ 3Í∞ú Í∏ÄÏùÑ Ïó¨Í∏∞Îã§ ÏÇΩÏûÖÌï©ÎãàÎã§ -->
        </ul>
    </div>

    <!-- ‚ë¢ Í≤åÏãúÌåê -->
    <div class="container">
        <div class="row mb-3">
            <div class="col">
                <div class="dropdown">
                    <button class="btn btn-primary dropdown-toggle" type="button"
                            data-bs-toggle="dropdown" aria-expanded="false">ÏòµÏÖò
                    </button>
                    <ul class="dropdown-menu" id="pageOptionMenu">
                        <li><a class="dropdown-item" href="#" data-value="3">3Í∞úÏî© Î≥¥Í∏∞</a></li>
                        <li><a class="dropdown-item" href="#" data-value="5">5Í∞úÏî© Î≥¥Í∏∞</a></li>
                        <li><a class="dropdown-item" href="#" data-value="10">10Í∞úÏî© Î≥¥Í∏∞</a></li>
                    </ul>
                </div>
            </div>
            <div class="input-group col mb-3">
                <button class="btn btn-outline-secondary dropdown-toggle" id="searchTypeButton"
                        type="button" data-bs-toggle="dropdown" aria-expanded="false">Ï†úÎ™©
                </button>
                <ul class="dropdown-menu" id="searchType">
                    <li><a class="dropdown-item" href="#" data-value="TITLE">Ï†úÎ™©</a></li>
                    <li><a class="dropdown-item" href="#" data-value="CONTENT">ÎÇ¥Ïö©</a></li>
                    <li><a class="dropdown-item" href="#" data-value="ALL">Ï†úÎ™©+ÎÇ¥Ïö©</a></li>
                </ul>
                <input type="hidden" id="selectedSearchType" value="TITLE">
                <input type="text" class="form-control" id="keyword" placeholder="Í≤ÄÏÉâÏñ¥Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî">
                <button class="btn btn-primary" type="button" id="btnSearch">Í≤ÄÏÉâ</button>
            </div>
        </div>

        <div class="card shadow-sm rounded-4 mb-4 overflow-hidden">
            <table class="table table-hover mb-0">
                <thead class="table-light">
                <tr>
                    <th class="text-center">Î≤àÌò∏</th>
                    <th>Ï†úÎ™©</th>
                    <th class="text-center">ÏûëÏÑ±Ïûê</th>
                    <th class="text-center">ÏûëÏÑ±Ïùº</th>
                    <th class="text-center">Ï°∞ÌöåÏàò</th>
                </tr>
                </thead>
                <tbody id="postList"></tbody>
            </table>
        </div>

        <div class="d-flex justify-content-end mb-4">
            <a href="/postForm" class="btn btn-primary fw-bold rounded-3">Í∏Ä ÏûëÏÑ±</a>
        </div>

        <div id="paginationWrapper"></div>
    </div>

    <!-- footer -->
    <footer class="bg-light text-center text-lg-start mt-5 border-top">
        <div class="container p-4">
            <p class="text-center mb-0 text-muted">¬© 2025 Uminity. All rights reserved.</p>
        </div>
    </footer>

    <script src="/assets/js/util.js"></script>
    <script>
        window.onload = function () {
            // 1) Í≥µÌÜµ ÎÑ§ÎπÑ Î°úÎìú
            loadNavbar();

            // 2) Hot Issues Îç∞Ïù¥ÌÑ∞ Î°úÎìú (Ï°∞ÌöåÏàò ÎÇ¥Î¶ºÏ∞®Ïàú ÏÉÅÏúÑ 3Í∞ú)
            fetch('/api/posts?page=0&size=3&sort=viewCnt,desc')
                .then(res => res.json())
                .then(data => {
                    const hotList = document.getElementById('hotList');
                    hotList.innerHTML = '';
                    data.content.forEach(post => {
                        const li = document.createElement('li');
                        li.className = 'list-group-item d-flex justify-content-between align-items-center';
                        li.innerHTML = `
              <a href="/postDetail/${post.postId}" class="text-decoration-none flex-grow-1">
                ${post.title}
              </a>
              <span class="badge bg-danger rounded-pill">${post.viewCnt}</span>
            `;
                        hotList.appendChild(li);
                    });
                })
                .catch(err => console.error('Hot Issues Î°úÎìú Ïã§Ìå®:', err));

            // 3) Í∏∞Ï°¥ Í≤ÄÏÉâ¬∑ÌéòÏù¥ÏßÄ ÏòµÏÖò Î∞îÏù∏Îî©
            document.getElementById("btnSearch").onclick = function () {
                SEARCH_TYPE = document.querySelector("#selectedSearchType").value;
                SEARCH_WORD = document.querySelector("#keyword").value;
                postList();
            };
            document.querySelectorAll("#searchType .dropdown-item").forEach(item => {
                item.addEventListener("click", function (e) {
                    e.preventDefault();
                    document.getElementById("searchTypeButton").textContent = this.textContent;
                    document.getElementById("selectedSearchType").value = this.getAttribute("data-value");
                });
            });
            document.querySelectorAll("#pageOptionMenu .dropdown-item").forEach(item => {
                item.addEventListener("click", function (e) {
                    e.preventDefault();
                    SIZE = +this.getAttribute("data-value");
                    PAGE = 0;
                    CURRENT_PAGE_INDEX = 1;
                    postList();
                });
            });

            // 4) Ï¥àÍ∏∞ Ï†ÑÏ≤¥ Î™©Î°ù Ìò∏Ï∂ú
            postList();
        };

        let SIZE = 10, PAGE = 0, SEARCH_TYPE = 'TITLE', SEARCH_WORD = '';
        let TOTAL_POST_COUNT = 0, PAGE_LINK_COUNT = 5, CURRENT_PAGE_INDEX = 1;

        function postList() {
            const url = "/api/posts"
                + "?page=" + PAGE
                + "&size=" + SIZE
                + "&searchType=" + SEARCH_TYPE
                + "&keyword=" + encodeURIComponent(SEARCH_WORD);
            fetch(url)
                .then(res => res.json())
                .then(data => {
                    const tbody = document.getElementById("postList");
                    tbody.innerHTML = '';
                    data.content.forEach(post => {
                        tbody.innerHTML += `
              <tr>
                <td class="text-center">${post.postId}</td>
                <td><a href="/postDetail/${post.postId}"
                       class="text-decoration-none text-primary fw-semibold">${post.title}</a></td>
                <td class="text-center">${post.authorName}</td>
                <td class="text-center">${post.createdAt}</td>
                <td class="text-center">${post.viewCnt}</td>
              </tr>`;
                    });
                    makePaginationHTML(SIZE, data.totalPages, CURRENT_PAGE_INDEX,
                        data.totalElements, "paginationWrapper");
                })
                .catch(err => console.error("Í≤åÏãúÌåê Î°úÎìú Ïã§Ìå®:", err));
        }


        // Í≤åÏãúÍ∏Ä Î™©Î°ù Í∞ÄÏ†∏Ïò§Í∏∞
        async function postList() {

            let url = "/api/posts";
            let urlParams = "?page=" + PAGE +
                "&size=" + SIZE +
                "&searchType=" + SEARCH_TYPE +
                "&keyword=" + encodeURIComponent(SEARCH_WORD);

            let response = await fetch(url + urlParams); // api Ìò∏Ï∂ú


            if (response.ok) {
                let data = await response.json(); // json Î≥ÄÌôò
                console.log(data);
                let posts = data.content; // post Î™©Î°ù

                TOTAL_POST_COUNT = posts.totalElements; // Ï†ÑÏ≤¥ Í≤åÏãúÍ∏Ä Ïàò
                PAGE_LINK_COUNT = data.totalPages;

                makeListHtml(posts); // Í≤åÏãúÍ∏Ä Î∂ÄÎ∂Ñ
                addPagination(); // ÌéòÏù¥ÏßÄÎÑ§Ïù¥ÏÖò Î∂ÄÎ∂Ñ

            } else {
                console.error("HTTP Error:", response.status);
            }
        }


        function makeListHtml(posts) {
            let postListDiv = document.querySelector("#postList");
            postListDiv.innerHTML = "";

            posts.forEach(post => {
                let postDate = formatDate(post.createdAt);
                let tableHtml = `
					<tr>
						<td class="text-center">${post.postId}</td>
						<td><a href="/postDetail/${post.postId}" class="text-decoration-none text-primary fw-semibold">${post.title}</a></td>
						<td class="text-center">${post.authorName}</td>
						<td class="text-center">${postDate}</td>
						<td class="text-center">${post.viewCnt}</td>
					</tr>
				`;
                postListDiv.innerHTML += tableHtml;
            });
            window.postData = posts;
        }


        function addPagination() {
            makePaginationHTML(SIZE, PAGE_LINK_COUNT, CURRENT_PAGE_INDEX, TOTAL_POST_COUNT, "paginationWrapper");
        }

    </script>
</body>
</html>
