<!DOCTYPE html>
<html lang="ko">

<head>
	<meta charset="UTF-8">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-SgOJa3DmI69IUzQ2PVdRZhwQ+dy64/BUtbMJw1MZ8t5HZApcHrRKUc4W0kG879m7" crossorigin="anonymous">
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/js/bootstrap.bundle.min.js" integrity="sha384-k6d4wzSIapyDyv1kpU366/PK5hCdSbCRGRCMv+eplOQJWyd1fbcAu9OCUj5zNLiq" crossorigin="anonymous"></script>
	<link rel="stylesheet" href="/assets/css/style.css">
	<link rel="icon" type="image/png" href="/assets/images/favicon.png">
	<title>Uminity</title>
</head>

<body>

	<!-- navbar -->
	<nav class="navbar navbar-expand-lg bg-body-tertiary">
		<div class="container">
			<a class="navbar-brand" href="#">Uminity</a>
			<button class="navbar-toggler" type="button" data-bs-toggle="collapse"
				data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
				aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>
			<div class="collapse navbar-collapse" id="navbarSupportedContent">
				<ul class="navbar-nav me-auto mb-2 mb-lg-0">
					<li class="nav-item">
						<a class="nav-link active" aria-current="page" href="#">Home</a>
					</li>
					<li class="nav-item">
						<a class="nav-link">홍길동님 환영합니다.</a>
					</li>
				</ul>
				<ul class="navbar-nav mb-2 mb-lg-0">
					<li class="nav-item">
						<a class="nav-link active" aria-current="page" href="/login">Login</a>
					</li>
					<li class="nav-item">
						<a class="nav-link active" aria-current="page" href="#" id="linkLogout">Logout</a>
					</li>
				</ul>
			</div>
		</div>
	</nav>

	<!-- 게시판 -->
	<div class="container mt-5">
		<h2 class="text-center text-primary fw-bold mb-4"><a href="/">유미니티 게시판</a></h2>
		
		<div class="row">
			<!-- 페이지네이션 설정 -->
			<div class = "col">
				<div class="dropdown">
					<button class="btn btn-primary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
						옵션
					</button>
					<ul class="dropdown-menu" id="pageOptionMenu">
						<li><a class="dropdown-item" href="#" data-value="3">3개씩 보기</a></li>
						<li><a class="dropdown-item" href="#" data-value="5">5개씩 보기</a></li>
						<li><a class="dropdown-item" href="#" data-value="10">10개씩 보기</a></li>
					</ul>
				</div>
			</div>
			
			<!-- 게시글 검색 -->
			<div class="input-group col mb-3">
	            <!-- 드롭다운 -->
	            <div class="input-group-prepend">
	                <button class="btn btn-outline-secondary dropdown-toggle" id="searchTypeButton" type="button" data-bs-toggle="dropdown" aria-expanded="false">제목</button>
	                <ul class="dropdown-menu" id="searchType">
	                    <li><a class="dropdown-item" href="#" data-value="TITLE">제목</a></li>
	                    <li><a class="dropdown-item" href="#" data-value="CONTENT">내용</a></li>
	                    <li><a class="dropdown-item" href="#" data-value="ALL">제목+내용</a></li>
	                </ul>
	            </div>
	            <input type="hidden" id="selectedSearchType" value="TITLE">
	            <!-- 검색 필드 -->
	            <input type="text" class="form-control" id="keyword" placeholder="검색어를 입력하세요">
	            <!-- 검색 버튼 -->
	            <button class="btn btn-primary" type="button" id="btnSearch">검색</button>
	        </div>
		</div>
		
		
		<!-- 게시판 -->
		<div class="card shadow-sm rounded-4 mb-4">
			<table class="table table-hover mb-0">
				<thead class="table-light">
					<tr>
						<th class="text-center">번호</th>
						<th>제목</th>
						<th class="text-center">작성자</th>
						<th class="text-center">작성일</th>
						<th class="text-center">조회수</th>
					</tr>
				</thead>
				<tbody id="postList">
					<!-- 게시글 삽입 공간 -->
				</tbody>
			</table>
		</div>

		<!-- 글작성 버튼 -->
		<div class="d-flex justify-content-end">
			<button class="btn btn-primary fw-bold rounded-3">글 작성</button>
		</div>

		<!-- 페이지네이션 -->
		<div id="paginationWrapper">
		</div>
	</div>

	<!-- footer -->
	<footer class="bg-light text-center text-lg-start mt-5 border-top">
		<div class="container p-4">
			<p class="text-center mb-0 text-muted">
				© 2025 Uminity. All rights reserved.
			</p>
		</div>
	</footer>

	<script src="/assets/js/util.js"></script>
	<script>
		let SIZE = 10;
		let PAGE = 0;
		let SEARCH_TYPE = 'TITLE';
		let SEARCH_WORD = '';
		let TOTAL_POST_COUNT = 0;
		
		let PAGE_LINK_COUNT = 5;
		let CURRENT_PAGE_INDEX = 1;
	
	
		window.onload = function () {
			postList();
			
			document.querySelector("#btnSearch").onclick = function(){
				SEARCH_TYPE = document.querySelector("#selectedSearchType").value;
				SEARCH_WORD = document.querySelector("#keyword").value;
				postList();
			}
			
			
			document.querySelector("#linkLogout").onclick = logout;
			
			
			// 검색 필드 드롭다운 선택 이벤트
			document.querySelectorAll("#searchType .dropdown-item").forEach(item => {
			    item.addEventListener("click", function(event) {
			        event.preventDefault();
			        const selectedValue = this.getAttribute("data-value");
			        const displayText = this.textContent;
			        
			        // 버튼 텍스트 변경
			        document.getElementById("searchTypeButton").textContent = displayText;
			        
			        // 히든 필드에 선택된 값 설정
			        document.getElementById("selectedSearchType").value = selectedValue;
			    });
			});
			
			// 옵션 필드 드롭다운 선택 이벤트
			document.querySelectorAll("#pageOptionMenu .dropdown-item").forEach(item => {
				item.addEventListener("click", function(event) {
					event.preventDefault();
					
					SIZE = parseInt(this.getAttribute("data-value"));
					PAGE = 0;
					CURRENT_PAGE_INDEX = 1;
					
					postList();
				});
			});
		}	
		
		
		// 게시글 목록 가져오기
		async function postList() {
			
			let url = "/api/posts";
			let urlParams = "?page=" + PAGE + 
							"&size=" + SIZE + 
							"&searchType=" + SEARCH_TYPE + 
							"&keyword=" + encodeURIComponent(SEARCH_WORD);
			
			let response = await fetch(url + urlParams); // api 호출
			
			
			if(response.ok){
				let data = await response.json(); // json 변환
				console.log(data);
				let posts = data.content; // post 목록
				TOTAL_POST_COUNT = posts.totalElements; // 전체 게시글 수
				
				console.log(data.totalElements);
				PAGE_LINK_COUNT = data.totalPages;
				
				
				makeListHtml(posts); // 게시글 부분
				addPagination(); // 페이지네이션 부분
				
			}else{
				console.error("HTTP Error:", response.status);
			}
		}
			
			
		function makeListHtml(posts){
			let postListDiv = document.querySelector("#postList");
			postListDiv.innerHTML ="";
			posts.forEach((post, index) => {
				let tableHtml = `
					<tr>
						<td class="text-center">${post.postId}</td>
						<td><a href="#" class="text-decoration-none text-primary fw-semibold">${post.title}</a></td>
						<td class="text-center">개발중</td>
						<td class="text-center">${post.createdAt}</td>
						<td class="text-center">${post.viewCnt}</td>
					</tr>
				`;
				postListDiv.innerHTML += tableHtml;
			});
			window.postData = posts;
		}
		
		
		function addPagination(){
			makePaginationHTML(SIZE, PAGE_LINK_COUNT, CURRENT_PAGE_INDEX, TOTAL_POST_COUNT, "paginationWrapper");
		}
		
		
		function movePage(pageIndex){
			PAGE = pageIndex-1;
			CURRENT_PAGE_INDEX = pageIndex;
			postList();
		}

		
		async function logout() {
			alert("로그아웃!");
		}

	</script>
</body>

</html>