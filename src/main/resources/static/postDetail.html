<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-SgOJa3DmI69IUzQ2PVdRZhwQ+dy64/BUtbMJw1MZ8t5HZApcHrRKUc4W0kG879m7" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/js/bootstrap.bundle.min.js" integrity="sha384-k6d4wzSIapyDyv1kpU366/PK5hCdSbCRGRCMv+eplOQJWyd1fbcAu9OCUj5zNLiq"
            crossorigin="anonymous"></script>
    <link rel="stylesheet" href="/assets/css/style.css">
    <link rel="icon" type="image/png" href="/assets/images/favicon.png">
    <title>Uminity</title>
</head>

<body>

    <!-- navbar -->
    <div id="nav-placeholder" class="pb-5"></div>

	<!-- ê²Œì‹œê¸€ ìƒì„¸ -->
    <div class="container mt-5" >
        <div class="card mb-4" id="postDetail">
            
        </div>

        <!-- ëŒ“ê¸€ ëª©ë¡ -->
        <div class="mb-4">
            <h5>ëŒ“ê¸€ <strong>(2)</strong></h5>
            <div class="input-group mb-3 p-2 rounded border">
                <textarea class="form-control p-3" id="commentInput" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”." rows="3" style="resize: none;"></textarea>
                <button class="btn btn-primary" id="commentSubmit" style="width: 120px;">ë“±ë¡</button>
            </div>
            <div class="border rounded p-3 mb-3">
                <p><strong>ì‘ì„±ìëª…</strong> | 2025-05-13</p>
                <p>ëŒ“ê¸€ ë‚´ìš©ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
                <div class="d-flex justify-content-end">
                    <button class="btn btn-outline-primary btn-sm me-2">ìˆ˜ì •</button>
                    <button class="btn btn-outline-danger btn-sm">ì‚­ì œ</button>
                </div>
            </div>
        </div>
    </div>

    <!-- footer -->
    <footer class="bg-light text-center text-lg-start mt-5 border-top">
        <div class="container p-4">
            <p class="text-center mb-0 text-muted">
                Â© 2025 Uminity. All rights reserved.
            </p>
        </div>
    </footer>

	<script src="/assets/js/util.js"></script>
    <script>
    window.onload = function(){
    	loadNavbar();
    	postDetail();
    	listComments();
    	
    }
    
    let postId = window.location.pathname.split("/").pop();
    let PAGE = 0; let SIZE = 5;
    
    async function postDetail(){
    	let response = await fetch("/api/posts/" + postId);
    	
    	if(response.ok){
    		let data = await response.json();
        	console.log(data);
        	
        	makeDetailHtml(data);
    	}else{
    		console.error("HTTP Error:", response.status);
    	}
    	
    }
    
    function makeDetailHtml(post){
    	let postDate = formatDate(post.createdAt);
    	let postDetailDiv = document.querySelector("#postDetail").innerHTML =
    		`
    		<div class="card-body">
            <h2 class="card-title">${post.title}</h2>
            <div class="row">
        		<div class="col">
        			<p class="text-muted mb-2">ì‘ì„±ì: <strong>${post.authorName}</strong> | ì‘ì„±ì¼: <strong>${postDate}</strong></p>
        		</div>
        		<div class="col d-flex justify-content-end">
        			<p class="text-muted mb-3">ì¢‹ì•„ìš”: <strong>45</strong> | ì¡°íšŒìˆ˜: <strong>${post.viewCnt}</strong></p>
        		</div>
        	</div>
            <p class="card-text">${post.content}</p>
            <div class="d-flex justify-content-end">
                <a href="/postForm/${post.postId}" class="btn btn-outline-primary me-2">ìˆ˜ì •</a>
                <button class="btn btn-outline-danger" onclick="deletePost(${post.postId})">ì‚­ì œ</button>
            </div>
            <hr>
            <button class="btn btn-primary mb-3">ğŸ‘ ì¢‹ì•„ìš”</button>
        </div>
        `;
    		
    }
    
    
    async function listComments(){
    	let postId = window.location.pathname.split("/").pop();
    	
    }
    
    function deletePost(postId) {
        if (!confirm("ì´ ê²Œì‹œê¸€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
            return;
        }

        fetch(`/api/posts/${Number(postId)}`, {
            method: "DELETE"
        })
        .then(response => {
            if (response.ok) {
                alert("ê²Œì‹œê¸€ì´ ì„±ê³µì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
                location.href = "/";
            } else {
                alert("ê²Œì‹œê¸€ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
                console.error("HTTP Error:", response.status);
            }
        })
        .catch(error => {
            console.error("ì„œë²„ ì˜¤ë¥˜:", error);
            alert("ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        });
    }

    </script>
</body>

</html>